# Requirements Document

## Introduction

This specification defines the migration of the TripRadar user registration flow from a username-based system to an email-only registration system. The backend API has been updated to remove the username field from registration and automatically generate usernames from email addresses. The frontend must be updated to align with these API changes while maintaining a smooth user experience.

## Glossary

- **System**: The TripRadar web application frontend
- **User**: A person registering for or using the TripRadar platform
- **Registration Form**: The UI component where users create new accounts
- **Email Confirmation**: The process of verifying a user's email address via a token sent by email
- **Username**: A unique identifier automatically generated by the backend from the user's email address
- **API Client**: The frontend service responsible for making HTTP requests to the backend
- **Auth Store**: The Zustand store managing authentication state in the frontend

## Requirements

### Requirement 1: Email-Only Registration Form

**User Story:** As a new user, I want to register using only my email address, so that I can quickly create an account without choosing a username.

#### Acceptance Criteria

1. WHEN a user visits the registration page THEN the System SHALL display a form with email, password, and consent checkbox fields
2. WHEN a user submits the registration form THEN the System SHALL send only email, password, and hasDataStorageConsent to the backend API
3. WHEN the registration form is rendered THEN the System SHALL NOT display a username input field
4. WHEN a user successfully registers THEN the System SHALL redirect to the email confirmation page
5. WHEN the backend returns an error THEN the System SHALL display the error message to the user

### Requirement 2: Optional User Profile Fields

**User Story:** As a new user, I want to optionally provide my first name, last name, and phone number during registration, so that I can personalize my account from the start.

#### Acceptance Criteria

1. WHEN a user views the registration form THEN the System SHALL display optional fields for firstName, lastName, and phoneNumber
2. WHEN a user submits the form with optional fields filled THEN the System SHALL include these values in the registration API request
3. WHEN a user submits the form with optional fields empty THEN the System SHALL send null or omit these fields in the API request
4. WHEN optional fields are displayed THEN the System SHALL clearly indicate they are not required
5. WHEN a user enters invalid data in optional fields THEN the System SHALL display appropriate validation errors

### Requirement 3: Promo Code Support

**User Story:** As a new user with a promo code, I want to enter it during registration, so that I can receive promotional benefits.

#### Acceptance Criteria

1. WHEN a user views the registration form THEN the System SHALL display an optional promo code input field
2. WHEN a user enters a promo code THEN the System SHALL include it in the registration API request
3. WHEN the promo code field is empty THEN the System SHALL send null or omit the field in the API request
4. WHEN the backend rejects an invalid promo code THEN the System SHALL display the error message to the user
5. WHEN a valid promo code is applied THEN the System SHALL show confirmation after successful registration

### Requirement 4: Email Confirmation Flow

**User Story:** As a registered user, I want to confirm my email address by clicking a link, so that I can activate my account and log in.

#### Acceptance Criteria

1. WHEN a user completes registration THEN the System SHALL display a page instructing them to check their email
2. WHEN a user clicks the confirmation link in their email THEN the System SHALL call the email confirmation API endpoint
3. WHEN email confirmation succeeds THEN the System SHALL redirect to a success page with a login button
4. WHEN email confirmation fails THEN the System SHALL display an error message with instructions
5. WHEN the confirmation endpoint returns a 302 redirect THEN the System SHALL follow the redirect to the appropriate page

### Requirement 5: Login Flow Compatibility

**User Story:** As a registered user, I want to log in using my email address, so that I don't need to remember a username I didn't choose.

#### Acceptance Criteria

1. WHEN a user enters their email in the login form THEN the System SHALL accept it as a valid usernameOrEmail value
2. WHEN a user logs in with email and password THEN the System SHALL send the credentials to the login API endpoint
3. WHEN login succeeds THEN the System SHALL store the authentication tokens and user data
4. WHEN the backend returns a username in the login response THEN the System SHALL store it in the auth state
5. WHEN a user has not confirmed their email THEN the System SHALL display a message prompting email confirmation

### Requirement 6: TypeScript Type Safety

**User Story:** As a developer, I want TypeScript types to match the backend API schema, so that I can catch errors at compile time.

#### Acceptance Criteria

1. WHEN the API schema changes THEN the System SHALL regenerate TypeScript types from the Swagger specification
2. WHEN CreateUserRequest is used THEN the System SHALL enforce the presence of email, password, and hasDataStorageConsent fields
3. WHEN CreateUserRequest is used THEN the System SHALL NOT require a username field
4. WHEN optional fields are used THEN the System SHALL type them as string | null | undefined
5. WHEN API types are imported THEN the System SHALL use the generated types from shared/api/generated-types.ts

### Requirement 7: Google OAuth Integration

**User Story:** As a new user, I want to register using my Google account, so that I can skip manual registration.

#### Acceptance Criteria

1. WHEN a user clicks "Continue with Google" THEN the System SHALL initiate the Google OAuth flow
2. WHEN Google OAuth succeeds THEN the System SHALL send the Google ID token to the backend
3. WHEN the backend creates a user from Google OAuth THEN the System SHALL store the returned authentication tokens
4. WHEN a Google user is created THEN the System SHALL extract firstName and lastName from the Google profile
5. WHEN Google OAuth completes THEN the System SHALL redirect the user to their profile page

### Requirement 8: Form Validation

**User Story:** As a user filling out the registration form, I want immediate feedback on validation errors, so that I can correct mistakes before submitting.

#### Acceptance Criteria

1. WHEN a user enters an invalid email format THEN the System SHALL display an error message below the email field
2. WHEN a user enters a password shorter than 6 characters THEN the System SHALL display a password length error
3. WHEN a user attempts to submit without checking the consent checkbox THEN the System SHALL prevent submission and show an error
4. WHEN a user corrects a validation error THEN the System SHALL remove the error message immediately
5. WHEN all required fields are valid THEN the System SHALL enable the submit button

### Requirement 9: Error Handling and User Feedback

**User Story:** As a user encountering an error, I want clear feedback about what went wrong, so that I can take appropriate action.

#### Acceptance Criteria

1. WHEN the backend returns a 400 error THEN the System SHALL display the error message from the API response
2. WHEN the network request fails THEN the System SHALL display a generic network error message
3. WHEN an email is already registered THEN the System SHALL display a message suggesting login instead
4. WHEN the API is unavailable THEN the System SHALL display a message asking the user to try again later
5. WHEN an error occurs THEN the System SHALL log the error details to the console for debugging
